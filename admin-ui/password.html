<!DOCTYPE html>

<html class="" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Inschrijven LR</title>
<link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/assets/favicon.svg">
<meta name="application-name" content="Inschrijven LR">
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="../style.css"/>
<script type="module" src="../assets/header-date.js" defer></script>
<script type="module" src="/src/firebase.js" defer></script>
</head>
<body class="app light">
<header class="nav-header">
    <div class="nav-inner">
    
            <a id="home-button" class="back-button home-button" aria-label="Home" href="../index.html">
                <span class="material-symbols-outlined">home</span>
            </a>
      <div class="title-container">
        <h1 class="page-title">Wachtwoord</h1>
        <span class="header-date" aria-hidden="true"></span>
      </div>
      <img class="header-logo" src="../assets/logo_MC_nieuw_trans_300.gif" alt="MC logo">
    </div>
</header>
<main class="main-content">
<h1 class="section-title">
                    Wachtwoord Invoeren
                </h1>
<p class="terms-card__text">
                    Voer hieronder het wachtwoord in dat u van de organisator heeft ontvangen om toegang te krijgen.
                </p>
</div>
<div class="planned-rides">
    <form id="password-form" autocomplete="on">
        <label class="form-label">
            <span class="sr-only">Wachtwoord</span>
            <div class="icon-input">
                <input autocomplete="current-password" class="form-input" id="password-input" placeholder="Wachtwoord" type="password" value="" style="padding: 8px;" />
                <button aria-label="Toggle password visibility" class="icon-toggle" onclick="togglePasswordVisibility()" type="button">
                    <span class="material-symbols-outlined" id="eye-icon">visibility</span>
                </button>
            </div>
        </label>
        <button type="submit" id="admin-confirm" class="primary-button">
            <span>Bevestigen</span>
        </button>
    </form>
</div>
</main>
<script>
        function togglePasswordVisibility() {
            const input = document.getElementById('password-input');
            const icon = document.getElementById('eye-icon');
            if (input.type === "password") {
                input.type = "text";
                icon.textContent = "visibility_off";
            } else {
                input.type = "password";
                icon.textContent = "visibility";
            }
        }
                                // Admin auth: use local SDK wrapper (no CDN)
                                (function(){
                                        const script = document.createElement('script');
                                        script.type = 'module';
                                        script.textContent = `import { initFirebase, db, doc, getDoc } from '/src/firebase.js';

await initFirebase();

async function getAdminPasswords() {
    try {
        const snap = await getDoc(doc(db, 'globals', 'passwords'));
        if (!snap || !snap.exists()) return { inschrijftafel: 'Shadow', hoofdadmin: '1100' };
        const data = snap.data() || {};
        return { inschrijftafel: String(data.inschrijftafel || 'Shadow'), hoofdadmin: String(data.hoofdadmin || '1100') };
    } catch (e) {
        console.error('getAdminPasswords sdk error', e);
        return { inschrijftafel: 'ERROR', hoofdadmin: 'ERROR' };
    }
}

async function handleAdminConfirm(ev) {
    if (ev && typeof ev.preventDefault === 'function') ev.preventDefault();
    const input = document.getElementById('password-input');
    const pw = (input?.value || '').trim();
    if (!pw) { alert('Voer een wachtwoord in'); return; }
    try {
        const p = await getAdminPasswords();
        const ins = String(p.inschrijftafel || 'Shadow').trim();
        const hoofd = String(p.hoofdadmin || '1100').trim();
        const setRole = (r) => { try { const v = String(r || '').trim().toLowerCase(); localStorage.setItem('role', v); try { console.debug('set role ->', v); } catch(_){} } catch(_){} };
        if (pw === hoofd) {
            setRole('admin');
            window.location.href = './inschrijftafel.html';
            return;
        }
        if (pw === ins) {
            setRole('inschrijftafel');
            window.location.href = './inschrijftafel.html';
            return;
        }
        // Clear any previous role on failed attempt
        setRole('');
        alert('Onjuist wachtwoord');
    } catch (e) {
        console.error('admin confirm error', e);
        alert('Fout tijdens verificatie');
    }
}

document.getElementById('password-form')?.addEventListener('submit', handleAdminConfirm);
`;
                                        document.body.appendChild(script);
                                })();

        // Ensure page remains scrollable when mobile keyboard opens and inputs stay visible
        (function(){
            const input = document.getElementById('password-input');
            const container = document.querySelector('.max-w-md');
            if (!input || !container) return;
            input.addEventListener('focus', () => { setTimeout(()=>{ try { input.scrollIntoView({ behavior: 'smooth', block: 'center' }); } catch(e){} }, 300); });
            // Adjust bottom padding based on visualViewport (keyboard height)
            if (window.visualViewport) {
                const apply = () => {
                    const vb = window.visualViewport;
                    const extra = Math.max(0, window.innerHeight - vb.height);
                    try { container.style.paddingBottom = (24 + extra) + 'px'; } catch(e){}
                };
                window.visualViewport.addEventListener('resize', apply);
                // initial apply
                apply();
            }
        })();
    </script>
</body></html>
