<!doctype html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shadow App</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://unpkg.com/html5-qrcode" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <header class="topbar">
      <img id="clubLogo" src="assets/logo_MC_nieuw_trans_300.gif" alt="Shadow Motorclub logo" width="100" height="30"  />
      <nav class="nav">
        <button id="tabMember" class="tab active">Lid</button>
        <button id="tabAdmin" class="tab">Inschrijftafel</button>
      </nav>
    </header>

    <main class="wrap">


      <header id="siteHeader" class="site-header">
      
    </header>
      <section id="viewMember" class="view active">
      <!-- Geplande ritten voor leden (zichtbaar zolang de gebruiker nog niet akkoord heeft gedrukt) -->
      <section id="plannedRidesSection" class="card" aria-labelledby="plannedRidesTitle">
        <h3 id="plannedRidesTitle">Geplande ritten</h3>
        <p class="muted">Hieronder vind je de geplande ritdata. Je ziet deze zolang je nog niet op "Ik ga akkoord" hebt geklikt.</p>
        <ul id="plannedRidesList" class="hint" style="margin-top:8px;"></ul>
      </section>
<section id="rideConsentGate" class="consent card" aria-labelledby="rideConsentTitle">
  <div class="consent__header">
    <h2 id="rideConsentTitle">Voorwaarden deelname</h2>
    <p>Hierbij verklaar ik <strong>voor eigen risico</strong> mee te rijden met deze rit.</p>
  </div>
  <div class="consent__actions">
    <button id="rideConsentBtn" class="btn btn-primary">Ik ga akkoord</button>
  </div>
  <p id="rideConsentWarn" class="msg" role="status" aria-live="polite"></p>
</section>
        <section id="landelijkeSignup" data-ride-signup="true" hidden>
<div class="card">
          <h1>Inschrijven voor Landelijke rit</h1>
          <p class="hint">Zoek op achternaam (Hoofletter gevoelig) en toon jouw QR.</p>
          <div class="row">
            <input id="nameInput" placeholder="Achternaam..." />
          </div>

          <ul id="suggestions" class="suggest"></ul>
          <div id="error" class="error" style="display:none"></div>
          <div id="result" class="result" style="display:none">
            <div class="column">
              <div class="kv"><span class="label">Naam</span><span class="value" id="rName">‚Äî</span></div>
              <div class="kv"><span class="label">LidNr</span><span class="value" id="rMemberNo">‚Äî</span></div>
              <div class="kv"><span class="label">Gereden ritten</span><span class="value" id="rRidesCount">‚Äî</span></div>
              <div class="kv"><span class="label">Regio</span><span class="value" id="rRegion">‚Äî</span></div>
              <p>Ga nu naar de inschrijfbalie om in te checken voor de rit.</p>
            </div>
            <div class="column" style="align-items:center; gap:8px;">
              <canvas id="qrCanvas" width="220" height="220" aria-label="QR-code"></canvas>
              <div class="small muted" id="qrPrivacy" style="display:none">
                Privacy: de QR bevat alleen een LidNr, geen naam.
              </div>
            </div>
          </div>
        </div>
        </section>
      </section>

      <section id="viewAdmin" class="view">
  <nav id="adminSubtabs" class="subtabs" aria-label="Hoofdadmin secties" hidden>
    <button class="subtab" data-admin-tab="1" aria-pressed="true">Tab 1 ¬∑ Scannen & Handmatig</button>
    <button class="subtab" data-admin-tab="2" aria-pressed="false">Tab 2 ¬∑ Planning & Beheer</button>
    <button class="subtab" data-admin-tab="3" aria-pressed="false">Tab 3 ¬∑ Wachtwoorden</button>
    <button class="subtab" data-admin-tab="4" aria-pressed="false">Tab 4 ¬∑ Inschrijvingen & Sterren</button>
  </nav>

        <div class="card" id="qrScanCard" data-admin-group="1">
          <h3>QR code scannen</h3>
          <p class="muted">Gebruik de camera om QR-codes te scannen en direct gegevens te verwerken.</p>
          <div class="row" style="gap:12px; align-items:center;">
            <button id="adminScanStart" class="btn">üì∑ Start scanner</button>
            <button id="adminScanStop" class="btn btn-ghost">‚è∏Ô∏è Stop</button>
            <span id="adminQRStatus" class="status"></span>
          </div>
          <div id="adminQRReader" class="qr-reader" style="margin-top:12px;"></div>
          <div id="adminQRResult" class="muted" style="margin-top:8px;"></div>
        </div>

        <div class="card" id="manualRideCard" data-admin-group="1">
          <h3>Handmatig rit registreren</h3>
          <p class="muted">Zoek op achternaam (Hoofletter gevoelig), kies het juiste lid en klik op een <em>ritdatum</em> hieronder om direct te registreren.</p>
          <div class="row">
            <input id="adminManualSearchInput" placeholder="Achternaam..." autocomplete="off" />
            <button id="adminManualClear" class="btn btn-ghost">Wissen</button>
          </div>
          <ul id="adminManualSuggest" class="suggest" role="listbox" aria-label="Suggesties"></ul>
          <div id="adminManualError" class="error" style="display:none"></div>
          <div id="adminManualResult" class="result" style="display:none">
            <div class="column">
              <div class="kv"><span class="label">Naam</span><span class="value" id="adminMName">‚Äî</span></div>
              <div class="kv"><span class="label">LidNr</span><span class="value" id="adminMMemberNo">‚Äî</span></div>
              <div class="kv"><span class="label">Geregistreerde ritten</span><span class="value" id="adminMRidesCount">‚Äî</span></div>
              <div class="kv"><span class="label">Rit kiezen</span><span class="value"><span id="adminRideHint" class="muted">Kies een ritdatum hieronder.</span></span></div>
              <div id="adminRideButtons" class="chip-list" role="group" aria-label="Kies ritdatum"></div>
              
            </div>
          </div>
          <div id="adminManualStatus" class="status"></div>
        </div>

        
        <div class="card" id="ridePlannerCard" data-admin-group="2">
          <h3>Ritten plannen</h3>
          <p class="muted">Vul minimaal 5 datums in (6e is optioneel). Dit wordt opgeslagen als globale instelling in Firestore.</p>
          <div class="row" style="flex-wrap:wrap; gap:10px;">
            <input type="date" id="rideDate1" />
            <input type="date" id="rideDate2" />
            <input type="date" id="rideDate3" />
            <input type="date" id="rideDate4" />
            <input type="date" id="rideDate5" />
            <input type="date" id="rideDate6" />
          </div>
          <div class="row" style="gap:12px; align-items:center;">
            <button id="saveRidePlanBtn" class="btn">Opslaan</button>
            <button id="reloadRidePlanBtn" class="btn btn-ghost">Herladen</button>
            <span id="ridePlanStatus" class="status"></span>
          </div>
        </div>

        <div class="card" id="excelUploadCard" data-admin-group="2">
          <h1>Admin: Excel uploaden</h1>
          <p class="hint">Benodigde kolommen (exact): <code>LidNr</code>, <code>Naam</code>, <code>Voor naam</code>, <code>Voor letters</code>, <code>Tussen voegsel</code>, <code>Regio Omschrijving</code>.</p>
          <div class="row">
            <input id="fileInput" class="file-input" type="file" accept=".xlsx,.xls,.csv" />
            <label for="fileInput" class="btn file-btn">üìÑ Kies bestand</label>
            <span id="fileName" class="file-name">Geen bestand gekozen</span>
            <button id="uploadBtn">Uploaden</button>
          </div>
          <div id="status" class="status"></div>
          <div id="log" class="log"></div>
        </div>

        
        <div class="card" id="rideStatsCard" data-admin-group="4">
          <h3>Inschrijvingen per rit</h3>
          <p class="muted">Aantal ingeschreven leden per geplande ritdatum (o.b.v. <code>ScanDatums</code>).</p>
          <div class="chart-box"><div class="chart-box"><canvas id="rideStatsChart" aria-label="Barchart inschrijvingen per rit"></canvas></div></div>
          <div class="row" style="gap:12px;align-items:center;margin-top:8px;">
            <button id="reloadStatsBtn" class="btn btn-ghost">Herladen</button>
            <span id="rideStatsStatus" class="status"></span>
          </div>
        </div>


        <div class="card" id="starDistCard" data-admin-group="4">
          <h3>Sterrenverdeling (Jaarhanger = Ja)</h3>
          <p class="muted">Aantal leden per aantal sterren (geplande datums vs. geregistreerde <code>ScanDatums</code>) gefilterd op <code>Jaarhanger = Ja</code>.</p>
          <div class="chart-box"><canvas id="starDistChart" aria-label="Histogram aantal sterren"></canvas></div>
          <div class="row" style="gap:12px;align-items:center;margin-top:8px;">
            <button id="reloadStarDistBtn" class="btn btn-ghost">Herladen</button>
            <span id="starDistStatus" class="status"></span>
          </div>
        </div>

        <div class="card" id="exportExcelCard" data-admin-group="4">
          <h1>Export leden (Excel)</h1>
          <p class="muted">Exporteer leden uit Firestore met vaste kolommen voor rapportage.</p>
          <div class="row">
            <button id="exportExcelBtn" class="btn">Export Excel</button>
            <span id="exportExcelStatus" class="muted" style="margin-left:8px;"></span>
          </div>
          <details class="muted" style="margin-top:8px;">
            <summary>Kolommen</summary>
            <code>Naam, Tussen voegsel, Voor letters, Voor naam, ridesCount, regio Omschrijving</code>
          </details>
        </div>

        <div class="card" id="resetRidesCard" data-admin-group="2">
          <h3>Beheer: Ritten resetten</h3>
          <p class="muted">Zet <strong>alle</strong> geregistreerde ritten (ridesCount) terug naar 0 voor alle leden.</p>
          <button id="resetRidesBtn" class="btn" style="border-color:#ef4444;">‚ö†Ô∏è Reset alle ritten</button>
          <div id="resetStatus" class="status"></div>
        </div>

        <div class="card" id="resetJaarhangerCard" data-admin-group="2">
          <h3>Beheer: Jaarhanger resetten</h3>
          <p class="muted">Reset de keuze voor <strong>Jaarhanger</strong> naar leeg voor <em>alle</em> leden. De waarde wordt in Firestore gezet naar een lege string (<code>""</code>).</p>
          <button id="resetJaarhangerBtn" class="btn" style="border-color:#ef4444;">‚ö†Ô∏è Reset Jaarhanger voor alle leden</button>
          <div id="resetJaarhangerStatus" class="status"></div>
        </div>

        <div id="resetModal" class="modal" style="display:none;">
          <div class="modal-dialog">
            <div class="modal-header">
              <h3>Reset alle ritten?</h3>
              <button id="resetClose" class="btn btn-ghost" aria-label="Sluiten">‚úï</button>
            </div>
            <div class="modal-body">
              <p>Weet je zeker dat je <strong>alle</strong> <code>ridesCount</code> waardes naar <strong>0</strong> wilt zetten?</p>
              <p class="muted">Deze actie geldt voor alle leden en kan niet ongedaan worden gemaakt.</p>
            </div>
            <div class="modal-actions">
              <button id="resetConfirm" class="btn" style="border-color:#ef4444;">Ja, reset alles</button>
              <button id="resetCancel" class="btn btn-ghost">Nee, annuleren</button>
            </div>
          </div>
        </div>
      
        <div class="card" id="adminPasswordCard" data-admin-group="3">
          <h3>Wachtwoord inschrijftafel resetten</h3>
          <p class="muted">Stel hier een nieuw <strong>Admin</strong>-wachtwoord in (voor de inschrijftafel). Dit heeft geen invloed op het <em>hoofdadmin</em>-wachtwoord.</p>
          <div class="row" style="gap:12px; align-items:center;">
            <input type="password" id="newAdminPwd" class="input" placeholder="Nieuw admin-wachtwoord" aria-label="Nieuw admin-wachtwoord" />
            <button id="saveAdminPwd" class="btn">Opslaan</button>
            <span id="pwdStatus" class="status" aria-live="polite"></span>
          </div>
          <div class="small muted" style="margin-top:6px;">Tip: kies iets dat je makkelijk kan delen met de inschrijftafel.</div>
        </div>
        
        <div class="card" id="adminRootPasswordCard" data-admin-group="3">
          <h3>Hoofdadmin wachtwoord veranderen</h3>
          <p class="muted">Wijzig het <strong>hoofdadmin</strong>-wachtwoord. Dit is het wachtwoord voor volledige toegang tot alle admin-functies.</p>
          <div class="row" style="gap:12px; align-items:center;">
            <input type="password" id="newRootPwd" class="input" placeholder="Nieuw hoofdadmin-wachtwoord" aria-label="Nieuw hoofdadmin-wachtwoord" />
            <button id="saveRootPwd" class="btn">Opslaan</button>
            <span id="rootPwdStatus" class="status" aria-live="polite"></span>
          </div>
          <div class="small muted" style="margin-top:6px;">Alleen zichtbaar/bruikbaar in hoofdadmin-modus.</div>
        </div>
        </section>
    </main>

    <div id="toast-root" aria-live="polite" aria-atomic="true"></div>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
