<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Speel audio</title>
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    .container{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:16px;text-align:center}
    .play-btn{display:inline-block;padding:12px 20px;background:#0078d4;color:#fff;border-radius:8px;font-size:18px;border:none}
    .notice{color:#666;margin-top:12px}
    audio{width:100%;max-width:480px;margin-top:18px}
    .member{font-weight:600;margin-top:8px}
    a.fallback{display:inline-block;margin-top:14px;color:#0078d4}
  </style>
</head>
<body>
  <div class="container">
    <h1>Audio player</h1>
    <div id="memberInfo" class="member" aria-live="polite"></div>
    <button id="bigPlay" class="play-btn" style="display:none">Tik om audio af te spelen</button>
    <audio id="player" controls></audio>
    <div class="notice">Als de audio niet automatisch start, tik op de knop hierboven.</div>
    <a id="fallbackLink" class="fallback" href="#" download>Audio openen / downloaden</a>
  </div>

  <script>
    function getQueryParam(name){
      try{const params=new URLSearchParams(location.search);return params.get(name);}catch(e){return null}
    }
    function safeJSONParse(s){try{return JSON.parse(s);}catch(e){return null}}

    (function(){
      const dataParam = getQueryParam('data');
      const payload = dataParam ? safeJSONParse(decodeURIComponent(dataParam)) : null;
      const player = document.getElementById('player');
      const playBtn = document.getElementById('bigPlay');
      const memberInfo = document.getElementById('memberInfo');
      const fallback = document.getElementById('fallbackLink');

      let audioUrl = null;
      if (payload && typeof payload === 'object'){
        if (payload.audioUrl) audioUrl = payload.audioUrl;
        // show member id if present
        const lid = payload.LidNr || payload.id || payload.lid || payload.lidnr || payload.uid || '';
        if (lid) memberInfo.textContent = 'Lidnummer: ' + String(lid);
      }
      if (!audioUrl){
        // fallback to a known relative file name if present
        audioUrl = '/assets/wet-fart-335478.mp3';
      }
      player.src = audioUrl;
      fallback.href = audioUrl;

      // Try to autoplay; many mobile browsers block autoplay without gesture.
      player.play().then(()=>{
        // playing
        playBtn.style.display = 'none';
      }).catch(()=>{
        // show a big play button so user can start playback
        playBtn.style.display = '';
      });

      playBtn.addEventListener('click', function(){
        player.play().catch(()=>{});
      });

      // If the page is opened by a scanner that expects a quick redirect to the audio file,
      // we could optionally redirect immediately instead of showing UI.
      // For now we keep the page so we can show member info and a play control.
    })();
  </script>
</body>
</html>
